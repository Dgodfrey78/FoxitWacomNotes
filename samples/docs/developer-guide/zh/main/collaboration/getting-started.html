<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>入门指南 | Foxit PDF SDK For Web - V8.0.0</title>
    <meta name="generator" content="VuePress 1.7.1">
    <script src="/docs/developer-guide/resetHref.js"></script>
    <link rel="icon" href="/docs/developer-guide/favicon.ico">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800">
    <meta name="description" content="Foxit PDF SDK For Web development guide">
    
    <link rel="preload" href="/docs/developer-guide/assets/css/0.styles.74d17c21.css" as="style"><link rel="preload" href="/docs/developer-guide/assets/js/app.c408d704.js" as="script"><link rel="preload" href="/docs/developer-guide/assets/js/2.59230382.js" as="script"><link rel="preload" href="/docs/developer-guide/assets/js/13.98e0832f.js" as="script"><link rel="prefetch" href="/docs/developer-guide/assets/js/10.0e6cb03c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/100.275e4f11.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/101.0275c124.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/102.1ff2b552.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/103.f25903bc.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/104.2830dbc2.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/105.b85920e7.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/106.ee02eac9.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/107.e5b41014.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/108.cb5c86fe.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/109.a08ac453.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/11.1b957cdd.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/110.9b283399.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/111.12fc388e.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/112.22a0c674.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/113.123aeeb2.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/114.e1992ff0.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/115.ebe3a032.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/116.85519956.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/117.7f053a26.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/118.856488e0.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/119.cbd8bd69.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/12.5757acd7.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/120.40ed51bf.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/121.b9b3716d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/122.4bc844ca.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/123.5626c778.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/124.bd69c79c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/125.de76f23a.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/126.ff5aba8b.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/127.72b1695d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/128.50a3da1c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/129.d2300d4b.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/14.b753c624.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/15.308b8c93.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/16.6cd4c9f4.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/17.f9915cce.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/18.1270ef25.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/19.c3e0896c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/20.0be28f5b.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/21.6cdce6fe.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/22.8b12f6f2.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/23.e444af59.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/24.3dba5af0.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/25.6fede48c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/26.bb748c44.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/27.51125825.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/28.aa624d78.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/29.f4a05189.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/3.7e434205.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/30.04ca1fbe.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/31.50d8928f.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/32.f3b1f655.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/33.9598650d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/34.7f677776.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/35.aa439153.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/36.0e5462ee.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/37.37de16f2.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/38.76ae122a.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/39.c330b3c6.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/4.9268b775.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/40.96f9f224.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/41.d91bd474.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/42.239e24fe.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/43.b7f49cb9.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/44.06a13bf3.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/45.8a0f32ae.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/46.1fac3e62.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/47.3d098d30.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/48.0b77c231.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/49.fd87f63c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/5.248add21.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/50.909b9f04.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/51.1625023d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/52.3866338b.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/53.a54ba124.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/54.3bdf21df.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/55.a7454215.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/56.87ba0b65.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/57.a9c5653a.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/58.bc1bec43.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/59.70711622.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/6.90319942.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/60.9cca886d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/61.83461745.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/62.601dfeb1.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/63.5bf682f5.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/64.536e754f.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/65.d6eaaefc.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/66.0188b597.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/67.bfa48862.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/68.99ab6a33.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/69.b8dcde17.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/7.73d76629.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/70.04912b11.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/71.c801843d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/72.468fc8c1.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/73.e77d2445.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/74.e2671093.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/75.49b49d52.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/76.f6653987.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/77.89b3ec6b.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/78.d33caa23.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/79.71eef718.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/8.1b44efd9.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/80.fbea28c6.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/81.92ae4d64.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/82.7be546aa.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/83.af631bad.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/84.88a0aa6a.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/85.da82cfa1.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/86.2b39c3a9.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/87.6d0aecf1.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/88.f13aac9c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/89.c527eb32.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/9.c18e136f.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/90.eceded8f.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/91.7fc73b2d.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/92.9b9ca143.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/93.801204bf.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/94.320ca1f9.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/95.70e5911a.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/96.0420d2a3.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/97.1216138c.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/98.3e250eb5.js"><link rel="prefetch" href="/docs/developer-guide/assets/js/99.00b93b60.js">
    <link rel="stylesheet" href="/docs/developer-guide/assets/css/0.styles.74d17c21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/developer-guide/" class="home-link router-link-active"><!----> <span class="site-name">Foxit PDF SDK For Web - V8.0.0</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/API_Reference/FoxitPDFSDK_API_Reference.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API Reference
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/docs/developer-guide/ui-extension/" class="nav-link">
  UIExtension
</a></div><div class="nav-item"><a href="/docs/developer-guide/technical-support/" class="nav-link">
  Technical Support
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow down"></span></button> <button type="button" aria-label="More" class="mobile-dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          devtools
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.npmjs.com/package/@foxitsoftware/gulp-merge-addon" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @foxitsoftware/addon-loader
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.npmjs.com/package/@foxitsoftware/addon-loader" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @foxitsoftware/gulp-merge-addon
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/API_Reference/FoxitPDFSDK_API_Reference.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API Reference
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/docs/developer-guide/ui-extension/" class="nav-link">
  UIExtension
</a></div><div class="nav-item"><a href="/docs/developer-guide/technical-support/" class="nav-link">
  Technical Support
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow down"></span></button> <button type="button" aria-label="More" class="mobile-dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          devtools
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.npmjs.com/package/@foxitsoftware/gulp-merge-addon" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @foxitsoftware/addon-loader
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.npmjs.com/package/@foxitsoftware/addon-loader" target="_blank" rel="noopener noreferrer" class="nav-link external">
  @foxitsoftware/gulp-merge-addon
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/developer-guide/main/getting-started/understanding-the-package-structure.html" class="sidebar-link">Understanding the Package Structure</a></li><li><a href="/docs/developer-guide/main/getting-started/quickly-run-samples.html" class="sidebar-link">Quickly Run Examples</a></li><li><a href="/docs/developer-guide/main/getting-started/integration.html" class="sidebar-link">Integration</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Examples</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Features</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Collaboration</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/developer-guide/main/best-practice.html" class="sidebar-link">Best Practice</a></li><li><a href="/docs/developer-guide/main/i18n-resources.html" class="sidebar-link">I18n Entries Resources Management</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Troubleshooting</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="入门指南"><a href="#入门指南" class="header-anchor">#</a> 入门指南</h1> <h2 id="快速运行collaboration示例"><a href="#快速运行collaboration示例" class="header-anchor">#</a> 快速运行collaboration示例</h2> <p>请参阅 <a href="/docs/developer-guide/zh/main/getting-started/quickly-run-samples.html">快速运行示例</a> 章节启动服务器，然后在浏览器中打开以下地址以访问collaboration示例：</p> <p><a href="http://127.0.0.1:8080/examples/UIExtension/collaboration/index.html" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080/examples/UIExtension/collaboration/index.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="工作原理"><a href="#工作原理" class="header-anchor">#</a> 工作原理</h2> <p>首先，打开API reference，找到collaboration相关的接口和类，如下所示：</p> <p><img src="/docs/developer-guide/assets/img/collaboration-api-reference-class-list.5310f672.jpg" alt="Collaboration classes list in API reference"></p> <p>其中，关键性的接口是：</p> <ol><li><p><code>CollaborationCommunicator</code></p> <p>该接口是浏览器和服务器之间的通信桥梁。它负责连接服务器、创建协作会话、同步数据等。在 <code>/examples/UIExtension/collaboration</code> 目录下，有一个基于communicator的sockjs，您可以参考其具体的实现，以了解更多详细信息。</p></li> <li><p><code>CollabroationDataHandler</code></p> <p>假设我们有两个客户端设备：客户端 A 和客户端 B。当客户端 A 创建一个注释时，其相关的注释数据将被发送到服务器，进而将进一步转发给客户端 B。当客户端 B 收到数据时，它会立即根据数据内容重复与客户端 A 相同的操作。此时，数据同步就实现了。客户端 B 的上述操作过程由 <code>CollabroationDataHandler</code> 接口实现，其定义了两种方法：</p> <ul><li><p><code>accept(data: CollaborationData): Promise&lt;boolean&gt;</code></p> <p>当接收到数据时，该方法将被调用并用于确认当前 <code>CollaborationDataHandler</code> 接口是否需要对数据进行处理。</p></li> <li><p><code>receive(data: CollaborationData, builtinHandler?: CollaborationDataHandler)</code></p> <p>当 <code>accept()</code> 方法返回true时，此方法将被调用，并传入两个参数。第一个参数是当前收到的协作数据，第二个是内置数据handler。在某些情况下，您需要决定是否调用内置数据handler。当操作行为没有定义在 <code>COLLABORATION_ACTION</code> 时调用了内置数据handler，则会导致不再执行其他同步操作。</p></li></ul></li> <li><p><code>CollaborationSessionInfo</code></p> <p>当客户端打开 PDF 文件时，它将向服务器发送一个创建新会话的请求。该会话包含当前 PDF 文件的信息以及其唯一标识shareId。通过这种方式，当分享带有shareId的链接给其他用户时，其他用户可以打开此链接并查看原始 PDF 文件，以及启动协作会话。</p></li> <li><p><code>UserCustomizeCollaborationData</code></p> <p>我们的 API 设计允许用户自定义协作操作。您可以通过 <code>PDFViewer.collaborate</code> API发送自定义协作数据，然后在自定义的 <code>CollaborationDataHandler</code> 中接收自定义协作数据以执行同步。</p></li> <li><p><code>COLLABORATION_ACTION</code></p> <p>内置协作操作的枚举。</p></li></ol> <p>协作如何工作？下面将详细解释整个过程。</p> <p>备注：Foxit PDF SDK for Web提供的collaboration 示例使用了Node.js作为后端服务器，并使用websocket作为通信通道来建立长时间的协作连接。</p> <ol><li><p>客户端A打开PDF文档，其中文档信息将被发送到服务器，并以唯一的shareID发起一个新的会话。在浏览器中，您将看到如下类似的地址：
<code>http://localhost:8080/examples/UIExtension/collaboration/index.html?shareId=2MF8Rp7-Q</code></p> <iframe frameborder="0" src="https://viewer.diagrams.net/?highlight=0000ff&amp;nav=1&amp;title=#RtVfbbts4EP0aP8bQ1Y4fHTvdXaCLBkiBtk8FbY1l7lKilqRju1%2FfoUhaoqk4Dap9kTiHwxE5Zy7UJF1Vpz8EafZ%2F8wLYJImK0yRdT5JkHs%2FxqYGzAdIkN0ApaGGguAOe6Q%2BwYGTRAy1AeoqKc6Zo44NbXtewVR5GhOBHX23Hmf%2FVhpQQAM9bwkL0Cy3U3qD3ybzD%2FwRa7t2X49nCzFTEKduTyD0p%2BLEHpY%2BTdCU4V2ZUnVbAtO%2BcX8y6D6%2FMXjYmoFa%2FssD6XaqzOxsUeFQrcqH2vOQ1YY8d%2BiD4oS5AG4hQ6nQ%2Bct4gGCP4Dyh1tryRg%2BII7VXF7CycqPqql09zK33rzaxP1nIrnK1g9qk39%2BpJLST5QWytVmKDg4gSrFZ68TJGJ%2FAKlDijigBGFH3xrRMbJ%2BVFzy5dCkHOPYWG01rJnuUnDaCCjfg8nhmLNuCT6IqWN%2FRTXx8HZgdO6h2lg1qqh2m3gfpC2MF5ato6QTa8loDDGo4mPAX8VQwGyUeywaz2iCWMljWOt8gJCAReQCiKebO0ExuuFK90DIGkP8imtafptQ5E4%2FnDJF9fCNcG4DSU1HZxl0r9UMiHSbaGomkcZXPPwdb2%2B6IgoO0unk1zz%2B5d4tvgu53ESPS5fC97ScBeQBCRjSl8O3rSqfrQgKD4Cc3KGq1hpYSnDrpJ4qVGaaIKIveX3JcN2dK6%2FNzmfYoArdrK6d5rWpV4GEY3%2BCRb7dnvBRW4M67d%2BOFIa7Qsv0sQSPRUvpS3iA9y%2FVWCs8XCZze3MXLsqnVmre57hdqpDTHu8XWDnDQgZ8UotFGyDGhC1zZ6eKjYUjullzJtej1xSRXlXupc55TS3u8TyA%2BK0RpWl%2BYXjePVNLoqYvPQq2kUenU2glddPbwV81AXS93cdewyIiXdXrWdGj%2F61TUXLXzrmpAWu87TSq71DLer6Ga70kIvv36jhaVhC0vGaGFB8UoWkU9vesWb2ZVddaN5pW8ZMmcJDL23qabujC7L5%2FmoTTIOu%2BSrCVyBlKb0jZOIs2GKe5mWDGRanI3SxhK%2FN97N%2F4ceFt8POHfG8CAPO95upvPy7L8DdxN3sr1VYimN4qw5dZM4KvV7xRkjGy5IWzfRTNtbnG3cljFvlAM%2BkRSNSyX4v0gc0yV5XfNaM7ujjF1BPbK1WXvjTTInW8PxQNmuaFG012nXbxns1DiFOsv9BLwP63Sc5%2B6m0g%2BgbIxSvQiYjaefGtBkoAv15RLdTyrdtcxTX%2BoEEAUtXVi4NXHDxPQc%2FqscvXkpvTBx3FMFz3in0d884p9r8LMzRhdNfHLibICd2UByJ%2B%2FnBsXuV9Ikafc%2Fnj7%2BBA%3D%3D" style="width:100%;height:274px;"></iframe></li> <li><p>客户端A分享协作链接给其他的客户端，这些客户端在打开链接后将被连接到同一台服务器。</p> <iframe frameborder="0" src="https://viewer.diagrams.net/?highlight=0000ff&amp;layers=1&amp;nav=1&amp;title=#R3Vjfk5s2EP5rmEkfkgHJ4Pjxzs4lmWlnbsadpnnKyCCDJgJRIZ9x%2F%2FquQPwQgvqaOr1JX2z0gVba71vtLnh4m9fvJSmzX0RCuYf8pPbwzkNoHazhVwOXFggxaoFUsqSFggHYsz%2BpAX2DnlhCK%2BtBJQRXrLTBWBQFjZWFESnF2X7sKLi9aklS6gD7mHAX%2FcQSlbXoW7Qe8A%2BUpVm3chBt2js56R42nlQZScR5BOF3Ht5KIVR7lddbyjV3HS%2FtvIeFu%2F3GJC3UcyagVTvjifCTcc5sTF06b6U4FQnVE3wP358zpui%2BJLG%2BewZ5ActUzmEUwKUxR6Wi9eKegt5TiBAqcqrkBR4xE5Bv2DLRgX1D1nngGq%2BM2WzM88o8SIy%2BaW97oAAuDAsLjFwnhFRlG1VHVmte7ksqGSxEJWBgDcKQPg7QmB7CWVrAdQxcNPf6ANDcJqTKeqIr4JgV6a8CGN5hAFjehGX3v2N5Cs5wdoBfEiv2RL8kTMLOhPb44cwKsFx9qagEOd5UT2kvj6PFjGKL8uDQlieYkWdOnfAG4mBHnC1n2hXk3zkyAbWlvjzl%2FE6TAu5rLxmc45%2FJgfJHUTHFhJbjIJQS%2BeiBO6OTEpP4FifFWUG3fWbxb8NqgCKb1WAm6H2X1egGrAbh9ZjvyDxyWt%2FpFApu0yIxl7uYk6pisQ5bRaRyYSdF0MTJsVcTxIiLcIaLDpOUE30c7Lw%2FQ5BZ4VGwJoQ6Kda%2BLcU0rVTiJGNqZo2T68QQDq8YAqpSqhxDjV6928%2BTMHIk%2FEQPlYi%2FUjUUQh3sU2EhPpWtT6Wk%2BAoRzvWR2RWi0EnnyDifQE4umx6enCWJXma2ZthV5RZlA09OkB%2B5eWkmatAtTtDaoX%2FfpN0lup%2FL8UiWoyiUaYWgapuxMRz8HfuOTjcgexWgq0Wgx8Zs36JEB2%2BXywA4F3HN8AG4j1LVu%2FuCheFfhnVoMY3xf1cYuqMxR%2FT2x6YVBy9Ia7BM6%2B4Hp3XzgrTOtDFb5N2vrd%2F%2Fbf1bre2UjKOZvvw71T%2Fk1r%2FFOL7aQY6koDVTv2uK3oRm9NkQpq939Xhw6QYFbH40SQ8%2Fd%2Fb0YJjWjC6WBNfbUnCq6f886wW6beW84RXypbrX1eQEovU3dq8rNOlepy9wt%2Bte0WYmfNoyngVDGW8R3fdYkRX9cRLdjddV0yHBy6AfhGU93OysdBkP%2BacK3q61chnV5kje%2FGUg98ekWws23i5nbwFgd19lBzzuHn5j9Azv3KKkxQPj9P6yb%2B2%2BMvZ%2FGlkqF%2FuUb09N5tsBAOH0S8JrtPQVR0D6OfLmMGaQuWjxXbKUP4mqjZulZo%2FH5p%2BnKRgOX9LasBw%2BR%2BJ3fwE%3D" style="width:100%;height:343px;"></iframe></li> <li><p>例如，客户端A执行创建一个注释的动作，该动作的操作数据将在后台同步发送到服务器，然后转发给其他的客户端。</p> <iframe frameborder="0" src="https://viewer.diagrams.net/?highlight=0000ff&amp;nav=1&amp;title=#R3Vlbc%2BI2FP41zLQPMLblCzw6Jt12Jk0ym8zu9ikjsADN2pYriwD99T3C8kWWCbk4zW5fiHQkHel85x6PUJTuP3Gcb%2F5kMUlGjhXvR2g%2BcpzADuBXEg4lATleSVhzGpckuyHc0X%2BIIlqKuqUxKbSNgrFE0FwnLlmWkaXQaJhzttO3rVii35rjNTEId0ucmNSvNBabkjp1gob%2BO6HrTXWz7c%2FKlRRXm5UkxQbHbNciocsRijhjohyl%2B4gkErsKl%2FLcbydW64dxkonnHEDlgUecbJVs6l3iUAmLi7zEcEX3BI5d5ITTlAjCgQbcAHRy25AuNiJNYMWGIU7oOoPxEl5zXKvFtWAS42IjGR4nRY6XNFvfsxwICAg0PSqh%2Bjun6RrESOgCfvFS0EfyEFMOL2P8AKQdzYBz8VAQ%2Fkj4pHhcw1kTDQUQbBFk3yIpdD4RBmJIhpZaRYHSlDJVe6bmu0bxruK6aencU9uwMrV1zbnRBgyUQvqV4xrKiRIqRXGs0FATQJvL4TZNQgkKiC%2BlpGC1V3hBkltWUEGZVMeCCcHS1oZQ6UlI9NsKZFuR0IxEtR9Zw6Bqo0BD1bFMVJFlouoPgKp33uQrLFcJ2YcyXoDUJIvVcL5McFHQpbRagbkwyS0ET4JFYi3GmFC1oPB6oKhonCRYeoMe5HrwUTfcMnq0oEoTU1vXBOpAXLAtXxJ1qh1JOoyQf4YRQLUmwmB0VFct9rM06Bsa%2FEoWBVt%2BJ6IJ%2BtLUu3oF6xS6egrB2Xew70Q6zDxjmQw5K5okHZIRybquk9I4ltdc7DZUkDuIZvLOHaQ%2FoHG2zeI61A3gP46r%2B489882o1GM0zgD%2BY5thyQC611lasIPk%2FPBN4jEJAqci%2FAWEsTWxgoow3yvIytmhPWulnKdRLe1OS3dnfe%2BtTuU5unqmweucyrV0p7K7AfCEUwH4%2BNDalssNxQse7Ftn3vXkfhiUL3ith9svCNIpKYqyVHhF4qps%2BbzntTzL6fGsitMbLWds6%2BXGuGM4bLUqyFvj53OqvgFTYMvZXTRtOzv4uuUN6uwdz%2B54v%2F%2BRmRbNOgnSdV4XFHxftxHkuu%2BVaXtK0P5UW%2FyguZYzgVXVO1TqtWcd9M3S1faCntzrnLaY5%2BZeZ2row5nIdiCOwyxTsgKcCV4wfpzMscA%2Fvm5mAynHtfS6CCFTOeCIPcoZoDBCZl1qIK8j0IeR0TsY0vdg9EShqMcKd9rTaPX1r7Y7BCKBgUjdwYJ0fiKtcMFhtBa1vB%2FY074Nat%2FXoPbs%2F66nRWZcqIGOfm5YkfuBsM5Owzr%2FuWF1nY%2BDtQot7UAZOaOLQPv9MZPWANB7FtKh76kg3qt5r0L9m5r3PRXfWuOykvfUrCnj5eSgwWZU5z3JvqyCR027Pnh37nbq5%2FqzwksLcc%2FqJNdgqjMaqDvv3lO1x0N121Uj8h7d9hlPcf%2F%2F3bbb122Xpc%2FGbkqfkrJix%2Fc1wPt%2Fb1m1MC6OX8JC2GBP832zWHGxZS8QcYIFkU1B3RFU3OGp5QX6pe0KrN5ovq3Icdb7NhmZxyrIysepOGs8L49XXyjZET5Z1i0K%2BaX3FTiVoTdbFPlxbkU3V1fhxc3n8P6Pm%2BuHMJJ%2FJtHny%2FD%2B8iG8vr65HzmReewZjONjfyQ1XiHXwHaTk3YTZZkMf20BVsJzopJ9ffJSH8aA4I06n8nGzqkmgoHbrZJjCN9AbiPZe%2BQxu%2FNPaOQYaczx3R7ntbwXJzKYNh9FSydsviyjy38B" style="width:100%;height:601px;"></iframe></li> <li><p>当其他的客户端收到同步的数据后，Web SDK将找到接收(通过 <code>accept</code> 方法)操作数据的第一个数据handler，并使用 <code>CollaborationDataHandler</code> 处理接收的数据，然后在屏幕上输出与客户端 A 相同的操作。</p> <iframe frameborder="0" src="https://viewer.diagrams.net/?highlight=0000ff&amp;nav=1&amp;title=#R7VrRctsoFP0az%2Bw%2BJCMJ27IfEzvdPnRnMs3utH3qEAnbbJHQIBzb%2B%2FV7sUBCgsSZREqzSV9scQEJzj3nckEaoUW2%2F0PgYvMnTwkbRUG6H6HlKIriMIZfZThUhgmKKsNa0LQyhY3hhv5LtDHQ1i1NSdlqKDlnkhZtY8LznCSyZcNC8F272Yqz9lMLvCaO4SbBzLV%2BoancVNZZFDf2j4SuN%2BbJ4XRe1WTYNNYzKTc45TvLhK5GaCE4l9VVtl8QprAzuFT9PtxTWw9MkFw%2BpsNYj%2BMOs62enB6YPJjZCr7NU6I6hCN0udtQSW4KnKjaHbgXbBuZMV2tb0eEJPt7xxTWMwWGEJ4RKQ7QxNAj0DhqdqC5HuSuwTqKUWXbWDhPdTus3buub90gABcaBD8g0Wk8cFlUpFrRvYLlsiCCwoOIABvcDVhIrhuTjQ5mdJ3DdQJQHOtq%2FwdQSHG5OeKsCiVATPP1XxwAXiIw0OzISvO%2FpNkaJsPoLfziRNI78j2lAkbG1Yw%2F7GgOdy6%2Fl0SAN87Lu3U%2F3gnHYcs74dT1jmliO2fSg3OM%2Fi1nkBSUqYtcyA1f8xyzq8Z62dBXwdq0%2BcSP0Cq3%2FEOkPOgwg7eS%2ByitHvQwZBCEsFgTbZr7URSEYeWrdkzyYKK7XnMKD2nQN1ow2hh3YC35ViRE9%2BogWw%2FjUWAjRwkLRslxMJeOG4DHhbrcZuxCMRBgUyyjEDM%2F4VvCrnlJJeWK%2B7dcSp5ZDS60KCTvxBK%2BlYzmZFFH8aAvCk%2FPJ20YI5fEKBgmwkxORxiD5oqR%2FYVar2DeJE%2F15TJhuCxpooIEME66ZgtDgEQcvirsYMq6%2BM2uW%2B41sFXpYEp7Kq1uUPpm1TSdVMHuYwU%2By12PEU%2FF3Bb3bD1FfpdaDpt4HGZsz5Wdw5ho%2FjjheRTs3Kqr4WrafWh4epprXl7ZBDJEsGlQk8JPhKc5%2FR4PPztittcrFD7VceMTofcetwG6%2BGA1K1SD8oEBh50FdjZ5eFyd9mZcDWuqETyVQ%2FHj41VGyrJKUnqJ4tOTko88kg%2FHvUj%2BLGy7%2Byxu34GvViV5rj5nDrbhOZQv0vQiz7nEaslccMbwLRfHwhJL7MAPGMo25qUU%2FAdAztRKvMx5rnyyoox1TE4%2B2l2TM5qmxyzKl%2Fa3MyuhxwvFeU8L9ZkByETKmWcnEHo4EPWwTs9P874NwPA7IzTphAbPzgiZgdt4oKCP7Dt0EIkUW1ew04C%2F9EjNYINzYIx4pSTtwQlR0Im3ntyxXiv6JmWI3AV8%2BB2QyQHCwXOAcJgkIA7awbxO7vtPuUL3BOEzyfgdaSK6CuIfK5mc4yQhhfxNief3ATTDyEr%2BdMWgaQd9j2LqrVXfivGlvG9JMdVeaXjFxIMpxnPS8HcBgvilmAZ9zyHbcIqJ37hiZi%2BiGGej2aNi3H1Da8vwmRTs8N41U%2Be8L6EZ8wLL3i0sotFl3Pp9nTnxABu3cdzxhe8lwVCu%2BN%2BkyM3ZrH0yax3U3nM2%2B7Swh%2FS5iH2oOg78buw5FI67fu0vFJpZ2a8pBPmVPNjohy8ZCN0j5xVmJXmlsa8HuKeok6t54B4s1rmHs%2B8N7ckLou2mXe8Nbc%2BB42Bouwew6Pyh2F6dPL7t2B5HPzG2j90k9wu5LXnyQ70IMV9bqUzyzQoinEVtQQyX2EKx%2BQ6syoyaj%2BnQ1X8%3D" style="width:100%;height:333px;"></iframe></li></ol> <p>至此，一个完整的协作操作过程已完成！</p> <h2 id="无线循环问题"><a href="#无线循环问题" class="header-anchor">#</a> 无线循环问题</h2> <p>查看以下代码，首先，注册 <code>DataEvent.annotationAdded</code> 事件，以便在事件触发后发送协作数据。然后，在一个button上注册一个单击事件，通过 <code>PDFPage.addAnnot</code> API创建注释。调用 <code>PDFPage.addAnnot</code> 方法将触发 <code>DataEvent.annotationAdded</code> 事件。这个逻辑看起来很完美。但是，假设此时有两个客户端 A 和 B。首先单击客户端 A 的按钮并发送协作数据，客户端 B 在收到协作数据后也调用 <code>PDFPage.addAnnot</code> 方法，然后问题就出现了。因为 <code>PDFPage.addAnnot</code> 触发了 <code>DataEvents.annotationAdded</code> 事件，事件回调函数也将发送协作数据，所有客户端在收到协作数据后将继续发送请求。在此过程中，无限循环问题就出现了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> DataEvents <span class="token operator">=</span> PDFViewCtrl<span class="token punctuation">.</span><span class="token constant">PDF</span><span class="token punctuation">.</span>DataEvents<span class="token punctuation">;</span>
pdfViewer<span class="token punctuation">.</span>eventEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>DataEvents<span class="token punctuation">.</span>annotationAdded<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">annots</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> pdfViewer<span class="token punctuation">.</span><span class="token function">getCurrentPDFDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">exportAnnotsToJSON</span><span class="token punctuation">(</span>annots<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">annotsJSONArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pdfViewer<span class="token punctuation">.</span><span class="token function">collaborate</span><span class="token punctuation">(</span>PDFViewCtrl<span class="token punctuation">.</span>collab<span class="token punctuation">.</span><span class="token constant">COLLABORATION_ACTION</span><span class="token punctuation">.</span><span class="token constant">CREATE_ANNOT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            annots<span class="token operator">:</span> annotsJSONArray
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $button <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#create-square-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$button<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> pdfViewer<span class="token punctuation">.</span><span class="token function">getCurrentPDFDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">getPageByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page<span class="token punctuation">.</span><span class="token function">addAnnot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token number">0xff0000</span><span class="token punctuation">,</span>
            rect<span class="token operator">:</span> <span class="token punctuation">{</span>  left<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> bottom<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            flags<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">'square'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> $button <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#create-line-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$button<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> pdfViewer<span class="token punctuation">.</span><span class="token function">getCurrentPDFDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">getPageByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page<span class="token punctuation">.</span><span class="token function">addAnnot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
            startStyle<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            endStyle<span class="token operator">:</span> <span class="token constant">PDF</span><span class="token punctuation">.</span>constant<span class="token punctuation">.</span>Ending_Style<span class="token punctuation">.</span>Square<span class="token punctuation">,</span>
            startPoint<span class="token operator">:</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            endPoint<span class="token operator">:</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            rect<span class="token operator">:</span> <span class="token punctuation">{</span>
                left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                right<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
                top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                bottom<span class="token operator">:</span> <span class="token number">100</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>为了避免该问题，需要从 <code>DataEvents</code> 回调中移除 <code>pdfViewer.collaborate</code> 的调用，并将其放置到单击事件回调中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> $button <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#create-square-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$button<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> pdfViewer<span class="token punctuation">.</span><span class="token function">getCurrentPDFDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">getPageByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page<span class="token punctuation">.</span><span class="token function">addAnnot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token number">0xff0000</span><span class="token punctuation">,</span>
            rect<span class="token operator">:</span> <span class="token punctuation">{</span>  left<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> bottom<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            flags<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">'square'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">annots</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> doc<span class="token punctuation">.</span><span class="token function">exportAnnotsToJSON</span><span class="token punctuation">(</span>annots<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">annotsJSONArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pdfViewer<span class="token punctuation">.</span><span class="token function">collaborate</span><span class="token punctuation">(</span>PDFViewCtrl<span class="token punctuation">.</span>collab<span class="token punctuation">.</span><span class="token constant">COLLABORATION_ACTION</span><span class="token punctuation">.</span><span class="token constant">CREATE_ANNOT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                annots<span class="token operator">:</span> annotsJSONArray
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> $button <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">'#create-line-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$button<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> pdfViewer<span class="token punctuation">.</span><span class="token function">getCurrentPDFDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">getPageByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        page<span class="token punctuation">.</span><span class="token function">addAnnot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
            startStyle<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            endStyle<span class="token operator">:</span> <span class="token constant">PDF</span><span class="token punctuation">.</span>constant<span class="token punctuation">.</span>Ending_Style<span class="token punctuation">.</span>Square<span class="token punctuation">,</span>
            startPoint<span class="token operator">:</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            endPoint<span class="token operator">:</span> <span class="token punctuation">{</span>x<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            rect<span class="token operator">:</span> <span class="token punctuation">{</span>
                left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                right<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
                top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                bottom<span class="token operator">:</span> <span class="token number">100</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">annots</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> doc<span class="token punctuation">.</span><span class="token function">exportAnnotsToJSON</span><span class="token punctuation">(</span>annots<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">annotsJSONArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pdfViewer<span class="token punctuation">.</span><span class="token function">collaborate</span><span class="token punctuation">(</span>PDFViewCtrl<span class="token punctuation">.</span>collab<span class="token punctuation">.</span><span class="token constant">COLLABORATION_ACTION</span><span class="token punctuation">.</span><span class="token constant">CREATE_ANNOT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                annots<span class="token operator">:</span> annotsJSONArray
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/developer-guide/assets/js/app.c408d704.js" defer></script><script src="/docs/developer-guide/assets/js/2.59230382.js" defer></script><script src="/docs/developer-guide/assets/js/13.98e0832f.js" defer></script>
  </body>
</html>
